---
title: "Arenas lab name checker usage"
author: "Oliver Tam and Julie Lowndes"
date: "6/26/2020"
output: html_document
---

## Introduction

This document is to keep track of our workflow using `name_checker.R`, a script to check that files conform to the Arenas lab nomenclature convention: 

We expect 7 sections, each separated by an underscore `_`:

- Experiment name & initial
- Experiment date and number
- Condition & replicate
- Dye/antibodies/transcript
- Image capture date
- Microscope type
- Lens, zoom & image number

Example: 

`NES-SAI2d15-CS_200514-01_Vehicle-1_DAPI+goPITX3-dk488+rbALDH1-dk555+moTH-dk647_200520_CF_10X-z2-3.tif`

Where:

- Experiment name & initial: `NES-SAI2d15-CS`. experiment name is NES-SAI2d15, CS is Carmen Salto
- Experiment date and number: `200514-01`. 14 May 2020, number 1
- Condition & replicate: `Vehicle-1`. Vehicle condition, replicate 1
- Dye/antibodies/transcript: `DAPI+goPITX3-dk488+rbALDH1-dk555+moTH-dk647`. Each element separated by `-`, if multiple separated by `+`
- Image capture date: `200520`: 20 May 2020
- Microscope type: `CF`. Confocal microscope 
- Lens, zoom & image number: `10X-z2-3`. 10x lens, 2 zoom, number 3.

## RStudio setup

We already have the repo cloned to our computers. (You can also download it and come to Office Hours next week to get help with setting up GitHub). 

Open the repo from RStudio File > Open Project... or in Finder/Windows Explorer by double-clicking the `NDCN_hackathon.Rproj` file.

Navigate to the "hackathon-arenas-02" folder. (You'll see we've tidied a bit since Hackathon 1).

We will work from this `name_checker_usage.Rmd` document today. It is an R Markdown document, which combines simple text and R code. You can use the Table of Contents at the bottom of the file to navigate. And please add your own notes!


## Code setup 
*TODO: if Shanzheng and Carmen use RStudio, can delete `here` requirement for the hackathon because it will automatically work with relative filepaths from the repo*

```{r setup}
## checks if the `here` package is installed, if not, installs 
if(! require(here)){
  install.packages("here")
}

## load libraries
library(here) # load `here` package

## source the script so you can use it
source(here("hackathon-arenas-02", "code", "name_checker.R"))
```


## Check names in test folder
TODO: enhance

Let' check the filenames in this folder

```{r}
check_file_names(here('hackathon-arenas-02/files'))
```

The default is to print to the screen. Can also have it save as an object that we can then write to a file. 

```{r}
logfile <- check_file_names(here('hackathon-arenas-02/files'))

write.table(logfile,"name_checking_log.txt",sep="\n",quote=F,row.names=F,col.names=F)
```

If we had multiple folders, we could run it for all of them and create one single log file:

```{r}

all_dirs = list.dirs() # list all directories
logfile = vector() # create empty object we will populate with log information from each directory

## loop through each directory. For each one:
for(i in 1:length(all_dirs)){
  cat(paste("Current folder is:", all_dirs[i]), "\n\n") 
  logfile = c(paste("Current folder is:", all_dirs[i]),"") # add the Current folder name
  logfile = c(logfile, check_file_names(all_dirs[i])) # run check_file_names
}

write.table(logfile,"name_checking_log.txt",sep="\n",quote=F,row.names=F,col.names=F)

```



## Check names in Carmen's folder

TODO


---
## Our internal testing
*Plan to delete pre-hackathon*

### Julie test files
3 files:

1. Julie forgot and put her initials with an underscore rather than dash
2. Julie deleted the image capture date
3. Julie deleted half of the dye/antibodies/transcript


```{r}
logfile <- check_file_names(here('hackathon-arenas-02/files_julietest'))
```

It behaves as we expect.

### Test run

```{r test-run}
all_dirs = list.dirs()
logfile = vector()
for(i in 1:length(all_dirs)){
  cat(paste("Current folder is:",all_dirs[i]), "\n\n")
  logfile = c(paste("Current folder is:",all_dirs[i]),"")
  logfile = c(logfile,check_file_names(all_dirs[i]))
}

write.table(logfile,"name_checking_log.txt",sep="\n",quote=F,row.names=F,col.names=F)

```





