---
title: "Arenas lab file renaming usage"
author: ""
date: "5/25/2020"
output: html_document
---

## Summary

This workflow is to rename files within the working directory folder. 

### Discussion

- working directory; where the script is vs. where the files are vs. where your working directory is
- where should this script live on Carmen's computer
  - maybe a folder called "analysis" from her home directory

## Setup

Download the GitHub folder. Move your "analysis" folder. Note that it has a .Rproj file; you can double-click that .Rproj file to open RStudio to this working directory.

We will be running these scripts from RStudio. 

Start off by RESTARTING R. File menu > Session > Restart R. 

(yes we just opened R with RStudio but it's a great habit to get into!)

```{r setup}

## libraries ---
## `here` package helps manage filepaths so that this will work more easily on different computers
library(here) # install.packages("here")


## script to source so you can use it
source(here("hackathon-arenas", "batch_rename_files.r"))

```

## Look through the script

Let's open the `batch_rename_files.r` script and get a sense of what it does. 

The `batch_rename_files.r` script has 1 main function:

`batch_rename_files`. It requires the user to provide inputs (in quotes!) for these variables:

- `microscope`, e.g. "BF"
- `antibody`, e.g. "Thrb488dkDAPI"
- `picture_date`, e.g. "20200522" -- recommend YYYYMMDD not YYMMDD. (even better: YYYY-MM-DD)
- `lens_magnification`, e.g. "20x2_0" -- recommend not using "." because can be confused with file extension

This function will: 

1. It will require user input to confirm how you set variables. We'll do this from the R Console. 
2. It will replace illegal characters: `[/\\?<>\\:*|\":]`
3. It will create new filename prefix and log information 
4. It will identify files to rename
5. Finally, it will Write information in the log file

## Testing the script

```{r usage, eval = FALSE}

## change your working directory to where the files are with `setwd()`

setwd(here("rename_files_examples/test_files"))

## rename files 
batch_rename_files(microscope = "BF",
             antibody = "Thrb488dkDAPI", 
             picture_date = "20200522",
             lens_magnification = "20x2_0")

```

What happens?

### What is wrong here: 

```{r usage, eval = FALSE}

rename_files(microscope = "BF",
             antibody, = "Thrb488dkDAPI", 
             picture_date = "20200522",
             lens_magnification = "20x2_0")


```

## Improving documentation and naming

- Let's add more comments to the function and to this .Rmd document so that you feel comfortable using it. 
- try using `----` in your code chunk comments so that you can navigate at the bottom of the file editor

### Renaming the script and functions 

- Do we want to rename the script or functions?
- Do we want to rename the "Converted" folder?

### Adding function documentation with ROxygen

1. Open `batch_rename_files.R`
1. Put your cursor in the function somewhere (e.g. below line 6)
1. Menu bar > Code > Insert Roxygen skeleton
1. Fill in the parameters with descriptions

## Adding functionality

Ideas to discuss and prioritize

- Should we have it print a message when completed, identifying the log file?
- Should we add a folder directory to the function so you can call it from anywhere?
- Can we run this script on a bunch of directories?

```{r multi_directory}

# Store current directory to get back to it at the end
current_directory <- getwd()

# This can be coded during runtime or provided as an input file
directory_list <- read.csv("list_of_directories.csv")
directory_list <- c("dirA", "dirB", "dirC")

# Parameters for renaming files can be provided as four separate vectors
microscopes <- c("BF","CF","EM")
antibodies <- c("Thrb488dkDAPI","Exosc3488nucHoechst","mtDNAgold")
picture_dates <- c("20200529","20200101","20191130")
lens_magnifications <- c("20x2_0","40x","TEM")

# Check that the parameter lists and directory lists are the same
if(length(directory_list) != length(microscopes)){
    stop(paste("There are", length(directory_list), "directories given, but only", length(microscopes), "microscope information provided"), call.=FALSE)
}
if(length(directory_list) != length(antibodies)){
    stop(paste("There are", length(directory_list), "directories given, but only", length(antibodies), "antibody information provided"), call.=FALSE)
}
if(length(directory_list) != length(picture_dates)){
    stop(paste("There are", length(directory_list), "directories given, but only", length(picture_dates), "picture dates provided"), call.=FALSE)
}
if(length(directory_list) != length(microscopes)){
    stop(paste("There are", length(directory_list), "directories given, but only", length(lens_magnifications), "lens magnification information provided"), call.=FALSE)
}

for(index in 1:length(directory_list)){
    if(dir.exists(directory_list[index])){
        setwd(directory_list[index])
        batch_rename_files(microscope = microscopes[index],
                           antibody = antibodies[index],
                           picture_date = picture_dates[index],
                           lens_magnification = lens_magnifications[index])
    }
    else{
        warning(paste("This directory", directory_list[index], "does not exist. Skipping"))
    }
}
setwd(current_directory)

```
